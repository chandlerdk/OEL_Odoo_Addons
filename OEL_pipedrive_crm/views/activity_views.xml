<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- =========================================================
         SEARCH VIEW: My Activities with date range filters
       ========================================================= -->
    <record id="view_mail_activity_search_oel" model="ir.ui.view">
        <field name="name">mail.activity.search.oel</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
            <search string="Activities">
                <field name="summary" string="Subject"/>
                <field name="user_id" string="Responsible"/>
                <field name="res_model"/>
                <field name="res_id"/>
                <field name="contact_id" string="Contact"/>
                <field name="date_deadline" string="Due Date"/>

                <filter string="Today" name="today"
                        domain="[('date_deadline', '=', context_today().strftime('%%Y-%%m-%%d'))]"/>
                <filter string="Tomorrow" name="tomorrow"
                        domain="[('date_deadline', '=', (context_today() + relativedelta(days=1)).strftime('%%Y-%%m-%%d'))]"/>
                <filter string="This Week" name="this_week"
                        domain="[('date_deadline', '>=', context_today().strftime('%%Y-%%m-%%d')),
                                 ('date_deadline', '&lt;=', (context_today() + relativedelta(days=6)).strftime('%%Y-%%m-%%d'))]"/>
                <filter string="Next Week" name="next_week"
                        domain="[('date_deadline', '>=', (context_today() + relativedelta(days=7)).strftime('%%Y-%%m-%%d')),
                                 ('date_deadline', '&lt;=', (context_today() + relativedelta(days=13)).strftime('%%Y-%%m-%%d'))]"/>
                <filter string="This Month" name="this_month"
                        domain="[('date_deadline', '&gt;=', context_today().replace(day=1).strftime('%%Y-%%m-%%d')),
                                 ('date_deadline', '&lt;=', (context_today().replace(day=1) + relativedelta(months=1, days=-1)).strftime('%%Y-%%m-%%d'))]"/>
                <filter string="Next Month" name="next_month"
                        domain="[('date_deadline', '&gt;=', (context_today().replace(day=1) + relativedelta(months=1)).strftime('%%Y-%%m-%%d')),
                                 ('date_deadline', '&lt;', (context_today().replace(day=1) + relativedelta(months=2)).strftime('%%Y-%%m-%%d'))]"/>

                <group expand="0" string="Group By">
                    <filter string="User" name="group_user" context="{'group_by': 'user_id'}"/>
                    <filter string="Due Date" name="group_date" context="{'group_by': 'date_deadline'}"/>
                    <filter string="Contact" name="group_contact" context="{'group_by': 'contact_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- =========================================================
         TREE VIEW: My Activities list
       ========================================================= -->
    <record id="view_mail_activity_tree_oel" model="ir.ui.view">
        <field name="name">mail.activity.tree.oel</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
            <tree string="My Activities" default_order="date_deadline">
                <field name="state" string="Status" widget="badge"
                       decoration-success="state == 'done'"
                       decoration-warning="state == 'today'"
                       decoration-danger="state == 'overdue'"/>
                <field name="create_date" string="Created"/>
                <field name="activity_type_id" string="Activity Type"/>
                <field name="summary" string="Summary"/>
                <field name="contact_id" string="Related Contact"/>
                <field name="res_model_id" string="Document Type"/>
                <field name="res_name" string="Document"/>
                <field name="user_id" string="Assigned to"/>
                <field name="date_deadline" string="Due Date"/>

                <!-- Extra / technical fields (hidden) -->
                <field name="res_model" invisible="1"/>
                <field name="res_id" invisible="1"/>
                <field name="contact_parent_id" invisible="1"/>
                <field name="contact_email" invisible="1"/>
                <field name="contact_phone" invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- =========================================================
         FORM VIEW: My Activity detail
       ========================================================= -->
    <record id="view_mail_activity_form_oel" model="ir.ui.view">
        <field name="name">mail.activity.form.oel</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
            <form string="Activity">
                <header>
                    <button name="action_mark_done_oel"
                            type="object"
                            string="Mark as Done"
                            class="btn-primary"/>
                    <button name="action_open_document_oel"
                            type="object"
                            string="Open Document"
                            class="btn-secondary"
                            invisible="not res_model or not res_id"/>
                    <field name="state" widget="statusbar"/>
                </header>

                <sheet>
                    <!-- Smart buttons -->
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_contact_oel"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-user"
                                invisible="not contact_id">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">View</span>
                                <span class="o_stat_text">Contact</span>
                            </div>
                        </button>
                    </div>

                    <!-- Main info -->
                    <group>
                        <group string="Activity">
                            <field name="activity_type_id" string="Activity Type"/>
                            <field name="summary"
                                   string="Subject"
                                   placeholder="Call, email, meeting..."/>
                            <field name="date_deadline" string="Due Date"/>
                            <field name="user_id" string="Assigned to"/>
                            <field name="create_date" string="Created" readonly="1"/>
                        </group>
                        <group string="Related Contact">
                            <field name="contact_id"
                                   string="Related Contact"
                                   required="1"/>
                            <field name="contact_parent_id" string="Org"/>
                            <field name="contact_email" string="Email" readonly="1"/>
                            <field name="contact_phone" string="Phone" readonly="1"/>
                        </group>
                    </group>

                    <!-- Linked document (Document only) -->
                    <group string="Linked Document">
                        <group>
                            <field name="res_name" string="Document" readonly="1"/>
                        </group>
                        <group>
                            <field name="res_model" invisible="1"/>
                            <field name="res_id" invisible="1"/>
                        </group>
                    </group>

                    <!-- Note (full width text area) -->
                    <group string="Note">
                        <field name="note"
                               nolabel="1"
                               placeholder="Add a note..."
                               colspan="4"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- =========================================================
         CALENDAR VIEW: My Activities
       ========================================================= -->
    <record id="view_mail_activity_calendar_oel" model="ir.ui.view">
        <field name="name">mail.activity.calendar.oel</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
            <calendar string="Activities"
                      date_start="date_deadline"
                      color="user_id"
                      event_open_popup="true"
                      quick_create="false">
                <field name="summary"/>
                <field name="res_model"/>
                <field name="res_id"/>
                <field name="user_id"/>
                <field name="activity_type_id"/>
                <field name="contact_id"/>
            </calendar>
        </field>
    </record>

    <!-- =========================================================
         ACTIONS
       ========================================================= -->
    <record id="action_oel_my_activities" model="ir.actions.act_window">
        <field name="name">My Activities</field>
        <field name="res_model">mail.activity</field>
        <field name="view_mode">tree,calendar,form</field>
        <field name="domain">[('user_id', '=', uid)]</field>
        <field name="search_view_id" ref="view_mail_activity_search_oel"/>
        <field name="view_ids" eval="[
            (5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('view_mail_activity_tree_oel')}),
            (0, 0, {'view_mode': 'calendar', 'view_id': ref('view_mail_activity_calendar_oel')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_mail_activity_form_oel')})
        ]"/>
        <field name="context">
            {
                "default_user_id": uid
            }
        </field>
    </record>

    <record id="action_oel_my_activities_calendar" model="ir.actions.act_window">
        <field name="name">My Calendar</field>
        <field name="res_model">mail.activity</field>
        <field name="view_mode">calendar,tree,form</field>
        <field name="domain">[('user_id', '=', uid)]</field>
        <field name="search_view_id" ref="view_mail_activity_search_oel"/>
        <field name="view_ids" eval="[
            (5, 0, 0),
            (0, 0, {'view_mode': 'calendar', 'view_id': ref('view_mail_activity_calendar_oel')}),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('view_mail_activity_tree_oel')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_mail_activity_form_oel')})
        ]"/>
        <field name="context">
            {
                "default_user_id": uid
            }
        </field>
    </record>

</odoo>
